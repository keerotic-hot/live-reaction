<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Live - Reaction</title>
    <style>
        #accounts-list {
            list-style: none;
        }
        
        #accounts-list li {
            width: 100px;
            height: 100px;
            float: left;
            margin: 5px;
        }
        
        #accounts-list a {
            display: block;
            width: 100%;
            height: 100%;
            background-size: cover !important;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
</head>

<body>
    <fb:login-button id="bt-login" scope="public_profile,email,pages_show_list" onlogin="checkLoginState();"></fb:login-button>
    <ul id="accounts-list">
    </ul>

    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCKl3QL__wYyhpBl1iBHowGLsjKz51VWE8",
            authDomain: "live-reaction.firebaseapp.com",
            databaseURL: "https://live-reaction.firebaseio.com",
            projectId: "live-reaction",
            storageBucket: "live-reaction.appspot.com",
            messagingSenderId: "956164106907"
        };
        firebase.initializeApp(config);
    </script>
    <script>
        var accounts = [];

        window.fbAsyncInit = function() {
            FB.init({
                appId: '1950700178499010',
                cookie: true,
                xfbml: true,
                version: 'v2.8'
            });
            FB.AppEvents.logPageView();

            FB.getLoginStatus(function(r) {
                statusChangeCallback(r);
            });
        };

        function statusChangeCallback(r) {
            console.log(r);
            //
            if (r.status === 'connected') {
                $('#bt-login').hide();

                listAccounts(function() {
                    console.log(accounts);
                    for (var i = 0; i < accounts.length; i++) {
                        $('#accounts-list').append(
                            '<li><a href="javascript:" onclick="listLiveVideos(\'' +
                            accounts[i].id +
                            '\');" style="background:url(https://graph.facebook.com/' +
                            accounts[i].id +
                            '/picture) center center no-repeat">' +
                            accounts[i].name +
                            '</a></li>');
                    }
                });
            } else {

            }
        }

        function listAccounts(callback, after) {
            var withAfter = '';
            if (after != undefined)
                withAfter = '&after=' + after;

            FB.api('me/accounts?limit=10' + withAfter, function(r) {
                console.log(r);
                accounts.push.apply(accounts, r.data);

                if (r.paging &&
                    r.paging.next &&
                    r.paging.cursors &&
                    r.paging.cursors.after) {
                    listAccounts(callback, r.paging.cursors.after);
                } else {
                    callback();
                }
            });
        }

        function listLiveVideos(id) {
            FB.api(id + '/live_videos', function(r) {
                console.log(r);
            });
        }

        function getReactions(videoId) {
            FB.api(videoId + '?fields=' +
                'reactions.type(LIKE).limit(0).summary(total_count).as(like),' +
                'reactions.type(LOVE).limit(0).summary(total_count).as(love),' +
                'reactions.type(HAHA).limit(0).summary(total_count).as(haha),' +
                'reactions.type(WOW).limit(0).summary(total_count).as(wow),' +
                'reactions.type(ANGRY).limit(0).summary(total_count).as(angry),' +
                'reactions.type(SAD).limit(0).summary(total_count).as(sad)',
                function(r) {
                    console.log(r);
                });
        }

        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
</body>

</html>